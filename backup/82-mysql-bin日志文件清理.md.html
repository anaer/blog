<p>在 MySQL 中，<code>mysql-bin</code> 是二进制日志（Binary Log）文件，用于记录数据库的所有更改操作（如 DDL、DML 操作）。当这类文件积累过多时，可能会占用大量磁盘空间。以下是清理这些文件的步骤和注意事项：</p>
<hr>
<div class="markdown-heading"><h3 class="heading-element"><strong>1. 确认是否需要保留二进制日志</strong></h3><a id="user-content-1-确认是否需要保留二进制日志" class="anchor" aria-label="Permalink: 1. 确认是否需要保留二进制日志" href="#1-确认是否需要保留二进制日志"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ul>
<li>
<strong>场景 1</strong>：如果 <strong>未启用主从复制</strong> 且 <strong>不需要通过二进制日志进行数据恢复</strong>，可以直接清理旧文件。</li>
<li>
<strong>场景 2</strong>：如果 <strong>有主从复制或定期备份需求</strong>，需确保清理操作不会影响主从同步或备份恢复。</li>
</ul>
<hr>
<div class="markdown-heading"><h3 class="heading-element"><strong>2. 查看当前二进制日志</strong></h3><a id="user-content-2-查看当前二进制日志" class="anchor" aria-label="Permalink: 2. 查看当前二进制日志" href="#2-查看当前二进制日志"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>登录 MySQL 并执行以下命令查看所有二进制日志文件：</p>
<div class="highlight highlight-source-sql"><pre>SHOW BINARY LOGS;</pre></div>
<p>输出示例如下：</p>
<pre><code>| Log_name          | File_size |
|-------------------|-----------|
| mysql-bin.000964  | 10738456  |
| mysql-bin.000965  | 20487654  |
| mysql-bin.000966  | 15678901  |
</code></pre>
<hr>
<div class="markdown-heading"><h3 class="heading-element"><strong>3. 清理方法</strong></h3><a id="user-content-3-清理方法" class="anchor" aria-label="Permalink: 3. 清理方法" href="#3-清理方法"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="markdown-heading"><h4 class="heading-element"><strong>方法 1：删除特定时间之前的日志（推荐）</strong></h4><a id="user-content-方法-1删除特定时间之前的日志推荐" class="anchor" aria-label="Permalink: 方法 1：删除特定时间之前的日志（推荐）" href="#方法-1删除特定时间之前的日志推荐"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>通过 <code>PURGE BINARY LOGS</code> 命令删除指定时间之前的所有日志：</p>
<div class="highlight highlight-source-sql"><pre>PURGE BINARY LOGS BEFORE <span class="pl-s"><span class="pl-pds">'</span>2024-10-01 00:00:00<span class="pl-pds">'</span></span>;</pre></div>
<p><strong>注意</strong>：</p>
<ul>
<li>替换 <code>2024-10-01</code> 为实际日期，确保此时间点之后的日志未被从服务器（slave）完全复制。</li>
<li>如果启用了主从复制，需确保从服务器的 <code>Relay Log</code> 已同步到主服务器的最新日志。</li>
</ul>
<div class="markdown-heading"><h4 class="heading-element"><strong>方法 2：删除指定文件之前的日志</strong></h4><a id="user-content-方法-2删除指定文件之前的日志" class="anchor" aria-label="Permalink: 方法 2：删除指定文件之前的日志" href="#方法-2删除指定文件之前的日志"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>删除某个日志文件（如 <code>mysql-bin.000964</code>）之前的所有日志：</p>
<div class="highlight highlight-source-sql"><pre>PURGE BINARY LOGS TO <span class="pl-s"><span class="pl-pds">'</span>mysql-bin.000964<span class="pl-pds">'</span></span>;</pre></div>
<p><strong>注意</strong>：</p>
<ul>
<li>此命令会删除 <code>mysql-bin.000964</code> 之前的日志，但保留该文件及之后的日志。</li>
</ul>
<div class="markdown-heading"><h3 class="heading-element"><strong>4. 配置自动过期策略</strong></h3><a id="user-content-4-配置自动过期策略" class="anchor" aria-label="Permalink: 4. 配置自动过期策略" href="#4-配置自动过期策略"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>在 <code>my.cnf</code>（或 <code>my.ini</code>）中设置二进制日志的自动清理策略：</p>
<div class="highlight highlight-source-ini"><pre><span class="pl-en">[mysqld]</span>
<span class="pl-c"><span class="pl-c">#</span> 保留 7 天的日志（单位：天）</span>
<span class="pl-k">expire_logs_days</span> = 7</pre></div>
<p>重启 MySQL 生效。</p>
<hr>
