
  <article class="markdown-body">
    <h2 id="_1">启动</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>$<span class="w"> </span>pm2<span class="w"> </span>start<span class="w"> </span>app.js<span class="w">                  </span><span class="c1"># 启动app.js应用程序  </span>
$<span class="w"> </span>pm2<span class="w"> </span>start<span class="w"> </span>app.js<span class="w"> </span>-i<span class="w"> </span><span class="m">4</span><span class="w">             </span><span class="c1"># cluster mode 模式启动4个app.js的应用实例, 4个应用程序会自动进行负载均衡  </span>
$<span class="w"> </span>pm2<span class="w"> </span>start<span class="w"> </span>app.js<span class="w"> </span>--name<span class="o">=</span><span class="s2">&quot;api&quot;</span><span class="w">     </span><span class="c1"># 启动应用程序并命名为 &quot;api&quot;  </span>
$<span class="w"> </span>pm2<span class="w"> </span>start<span class="w"> </span>app.js<span class="w"> </span>--watch<span class="w">          </span><span class="c1"># 当文件变化时自动重启应用  </span>
$<span class="w"> </span>pm2<span class="w"> </span>start<span class="w"> </span>script.sh<span class="w">               </span><span class="c1"># 启动 bash 脚本</span>
</code></pre></div></div>

<p>pm2 start app.js --node-args="--max-old-space-size=1024"  </p>
<h2 id="_2">查看进程</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>$<span class="w"> </span>pm2<span class="w"> </span>list<span class="w">                          </span><span class="c1"># 列表 PM2 启动的所有的应用程序  </span>
$<span class="w"> </span>pm2<span class="w"> </span>show<span class="w"> </span><span class="o">[</span>app-name<span class="o">]</span><span class="w">               </span><span class="c1"># 显示应用程序的所有信息</span>
</code></pre></div></div>

<h2 id="_3">监控</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>$<span class="w"> </span>pm2<span class="w"> </span>monit<span class="w">                         </span><span class="c1"># 显示每个应用程序的CPU和内存占用情况</span>
</code></pre></div></div>

<h2 id="_4">日志</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>$<span class="w"> </span>pm2<span class="w"> </span>logs<span class="w">                          </span><span class="c1"># 显示所有应用程序的日志  </span>
$<span class="w"> </span>pm2<span class="w"> </span>logs<span class="w"> </span><span class="o">[</span>app-name<span class="o">]</span><span class="w">               </span><span class="c1"># 显示指定应用程序的日志  </span>
$<span class="w"> </span>pm2<span class="w"> </span>flush<span class="w">                         </span><span class="c1"># 清空所有日志文件</span>
</code></pre></div></div>

<h2 id="_5">停止</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>$<span class="w"> </span>pm2<span class="w"> </span>stop<span class="w"> </span>all<span class="w">                      </span><span class="c1"># 停止所有的应用程序  </span>
$<span class="w"> </span>pm2<span class="w"> </span>stop<span class="w"> </span><span class="m">0</span><span class="w">                        </span><span class="c1"># 停止 id为 0的指定应用程序</span>
</code></pre></div></div>

<h2 id="_6">重载</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">reload</span><span class="w"> </span><span class="n">all</span><span class="w">                    </span><span class="c1"># 重启 cluster mode下的所有应用  </span>
<span class="o">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">gracefulReload</span><span class="w"> </span><span class="n">all</span><span class="w">            </span><span class="c1"># Graceful reload all apps in cluster mode  </span>
<span class="o">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">reload</span><span class="w"> </span><span class="n">pm2</span><span class="o">.</span><span class="n">json</span><span class="w"> </span><span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="n">env</span><span class="w">   </span><span class="c1">#配置修改后使用 --update-env 重载, 否则新配置如&quot;cron_restart&quot;可能不会生效</span>
</code></pre></div></div>

<h2 id="_7">重启</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>$<span class="w"> </span>pm2<span class="w"> </span>restart<span class="w"> </span>all<span class="w">                   </span><span class="c1"># 重启所有应用</span>
</code></pre></div></div>

<h2 id="_8">删除应用</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>$<span class="w"> </span>pm2<span class="w"> </span>delete<span class="w"> </span>all<span class="w">                    </span><span class="c1"># 关闭并删除所有应用  </span>
$<span class="w"> </span>pm2<span class="w"> </span>delete<span class="w"> </span><span class="m">0</span><span class="w">                      </span><span class="c1"># 删除指定应用 id 0</span>
</code></pre></div></div>

<h2 id="_9">其他</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="n">api</span><span class="w"> </span><span class="mi">10</span><span class="w">                  </span><span class="err">#</span><span class="w"> </span><span class="n">把名字叫api的应用扩展到10个实例</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">reset</span><span class="w"> </span><span class="o">[</span><span class="n">app-name</span><span class="o">]</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="n">重置重启数量</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">startup</span><span class="w">                       </span><span class="err">#</span><span class="w"> </span><span class="n">创建开机自启动命令</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="k">save</span><span class="w">                          </span><span class="err">#</span><span class="w"> </span><span class="n">保存当前应用列表</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">resurrect</span><span class="w">                     </span><span class="err">#</span><span class="w"> </span><span class="n">重新加载保存的应用列表</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="k">update</span><span class="w">                        </span><span class="err">#</span><span class="w"> </span><span class="k">Save</span><span class="w"> </span><span class="n">processes</span><span class="p">,</span><span class="w"> </span><span class="k">kill</span><span class="w"> </span><span class="n">PM2</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">restore</span><span class="w"> </span><span class="n">processes</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">generate</span><span class="w">                      </span><span class="err">#</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="k">file</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">deploy</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">json</span><span class="w"> </span><span class="n">prod</span><span class="w"> </span><span class="n">setup</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Setup</span><span class="w"> </span><span class="ss">&quot;prod&quot;</span><span class="w"> </span><span class="n">remote</span><span class="w"> </span><span class="n">server</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">deploy</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">json</span><span class="w"> </span><span class="n">prod</span><span class="w">          </span><span class="err">#</span><span class="w"> </span><span class="k">Update</span><span class="w"> </span><span class="ss">&quot;prod&quot;</span><span class="w"> </span><span class="n">remote</span><span class="w"> </span><span class="n">server</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">deploy</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">json</span><span class="w"> </span><span class="n">prod</span><span class="w"> </span><span class="k">revert</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="k">Revert</span><span class="w"> </span><span class="ss">&quot;prod&quot;</span><span class="w"> </span><span class="n">remote</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="k">module</span><span class="err">:</span><span class="n">generate</span><span class="w"> </span><span class="o">[</span><span class="n">name</span><span class="o">]</span><span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="k">module</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">[</span><span class="n">name</span><span class="o">]</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">pm2</span><span class="o">-</span><span class="n">logrotate</span><span class="w">         </span><span class="err">#</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="k">module</span><span class="w"> </span><span class="p">(</span><span class="n">here</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nf">log</span><span class="w"> </span><span class="n">rotation</span><span class="w"> </span><span class="k">system</span><span class="p">)</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">uninstall</span><span class="w"> </span><span class="n">pm2</span><span class="o">-</span><span class="n">logrotate</span><span class="w">       </span><span class="err">#</span><span class="w"> </span><span class="n">Uninstall</span><span class="w"> </span><span class="k">module</span><span class="w">  </span>
<span class="err">$</span><span class="w"> </span><span class="n">pm2</span><span class="w"> </span><span class="n">publish</span><span class="w">                       </span><span class="err">#</span><span class="w"> </span><span class="n">Increment</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">npm</span><span class="w"> </span><span class="n">publish</span>
</code></pre></div></div>

<h2 id="pm2json">pm2.json</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>{  
  &quot;apps&quot;: [  
    {  
      &quot;name&quot;: &quot;名称&quot;,  
      &quot;script&quot;: &quot;脚本名.py&quot;,  
      &quot;instances&quot;: 1,  
      &quot;interpreter&quot;: &quot;./.venv/bin/python&quot;,  
      &quot;autorestart&quot;: true,  
      &quot;watch&quot;: [&quot;main.py&quot;],  # 监听文件变更  
      &quot;cron_restart&quot;: &quot;0 0 * * *&quot;, # 每天0点 定时重启  
      &quot;merge_logs&quot;: false,   # 是否合并文件, false时 按pm2 id拆分日志文件, 如error_1.log  
      &quot;log_date_format&quot;: &quot;YYYY-MM-DD HH:mm Z&quot;, # 日志日期格式  
      &quot;error_file&quot;: &quot;logs/error.log&quot;, # 错误日志文件  
      &quot;out_file&quot;: &quot;logs/output.log&quot; # 日志文件  当error_file和out_file配置一样时, 可输出到同一个文件  
    }  
  ]  
}  
</code></pre></div></div>
<h2 id="pm2-logrotate">pm2-logrotate 日志切割</h2>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>pm2<span class="w"> </span>install<span class="w"> </span>pm2-logrotate<span class="w">  </span>
</code></pre></div></div>
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>pm2<span class="w"> </span>conf<span class="w"> </span><span class="c1"># 查询配置  </span>
pm2<span class="w"> </span><span class="nb">set</span><span class="w">    </span><span class="c1"># 修改配置文件  </span>
</code></pre></div></div>
<p>配置参数：<br />
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>pm2<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pm2-logrotate:max_size<span class="w"> </span>10M<span class="w">  </span><span class="c1"># 单个文件最大10M  </span>
pm2<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pm2-logrotate:retain<span class="w"> </span><span class="m">30</span><span class="w">     </span><span class="c1"># 保留30个历史文件  </span>
pm2<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pm2-logrotate:compress<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="c1"># 启用压缩  </span>
pm2<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pm2-logrotate:dateFormat<span class="w"> </span>YYYY-MM-DD_HH-mm-ss<span class="w"> </span><span class="c1"># 设置日志文件名格式  </span>
pm2<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pm2-logrotate:workerInterval<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="c1"># 每30秒检查日志文件大小  </span>
pm2<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pm2-logrotate:rotateInterval<span class="w"> </span><span class="s1">&#39;0 0 * * *&#39;</span><span class="w"> </span><span class="c1"># 每天0点执行  </span>
pm2<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pm2-logrotate:rotateModule<span class="w"> </span><span class="nb">true</span><span class="w">  </span>
</code></pre></div></div></p>
<p>手动触发日志切割<br />
<div class="highlight"><div class="code-block-wrapper"><div class="code-block-controls"><button class="fold-btn">▲</button><button class="copy-btn"><svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg></button></div>
<pre><span></span><code>pm2<span class="w"> </span>reloadLogs<span class="w">  </span>
</code></pre></div></div></p>
<h2 id="_10">相关链接</h2>
<ol>
<li><a href="https://github.com/keymetrics/pm2-logrotate">pm2-logrotate</a>  </li>
</ol>
  </article>
  
<style>
.code-block-wrapper {
  position: relative;
  display: inline-block;
  width: 100%;
}
.code-block-controls {
  position: absolute;
  top: 6px;
  right: 8px;
  z-index: 2;
  display: flex;
  gap: 2px;
}
.fold-btn, .copy-btn {
  border: none;
  background: transparent;
  cursor: pointer;
  padding: 2px 6px;
  font-size: 16px;
  outline: none;
  box-shadow: none;
  transition: background 0.2s;
}
.fold-btn:hover, .copy-btn:hover {
  background: #eee;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // 复制功能
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const code = btn.parentElement.parentElement.querySelector('pre code').innerText;
      navigator.clipboard.writeText(code).then(() => {
        btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><path fill="green" d="M7.629 15.314l-4.243-4.243 1.414-1.414 2.829 2.828 6.364-6.364 1.414 1.414z"/></svg>';
        setTimeout(() => {
          btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 20 20" style="vertical-align:middle"><rect x="6" y="2" width="9" height="13" rx="2" fill="#555"/><rect x="3" y="5" width="9" height="13" rx="2" fill="#aaa"/></svg>';
        }, 1500);
      });
    });
  });

  // 折叠功能
  document.addEventListener('click', e => {
    if (e.target.classList.contains('fold-btn')) {
      const code = e.target.parentElement.parentElement.querySelector('pre code');
      const collapsed = code.style.display === 'none';
      code.style.display = collapsed ? 'block' : 'none';
      e.target.textContent = collapsed ? '▲' : '▼';
    }
  });
});
</script>

