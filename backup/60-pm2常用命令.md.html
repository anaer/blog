<div class="markdown-heading"><h2 class="heading-element">启动</h2><a id="user-content-启动" class="anchor" aria-label="Permalink: 启动" href="#启动"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 start app.js                  # 启动app.js应用程序
$ pm2 start app.js -i 4             # cluster mode 模式启动4个app.js的应用实例, 4个应用程序会自动进行负载均衡
$ pm2 start app.js --name="api"     # 启动应用程序并命名为 "api"
$ pm2 start app.js --watch          # 当文件变化时自动重启应用
$ pm2 start script.sh               # 启动 bash 脚本
</code></pre>
<p>pm2 start app.js --node-args="--max-old-space-size=1024"</p>
<div class="markdown-heading"><h2 class="heading-element">查看进程</h2><a id="user-content-查看进程" class="anchor" aria-label="Permalink: 查看进程" href="#查看进程"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 list                          # 列表 PM2 启动的所有的应用程序
$ pm2 show [app-name]               # 显示应用程序的所有信息
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">监控</h2><a id="user-content-监控" class="anchor" aria-label="Permalink: 监控" href="#监控"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 monit                         # 显示每个应用程序的CPU和内存占用情况
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">日志</h2><a id="user-content-日志" class="anchor" aria-label="Permalink: 日志" href="#日志"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 logs                          # 显示所有应用程序的日志
$ pm2 logs [app-name]               # 显示指定应用程序的日志
$ pm2 flush                         # 清空所有日志文件
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">停止</h2><a id="user-content-停止" class="anchor" aria-label="Permalink: 停止" href="#停止"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 stop all                      # 停止所有的应用程序
$ pm2 stop 0                        # 停止 id为 0的指定应用程序
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">重载</h2><a id="user-content-重载" class="anchor" aria-label="Permalink: 重载" href="#重载"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 reload all                    # 重启 cluster mode下的所有应用
$ pm2 gracefulReload all            # Graceful reload all apps in cluster mode
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">重启</h2><a id="user-content-重启" class="anchor" aria-label="Permalink: 重启" href="#重启"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 restart all                   # 重启所有应用
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">删除应用</h2><a id="user-content-删除应用" class="anchor" aria-label="Permalink: 删除应用" href="#删除应用"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 delete all                    # 关闭并删除所有应用
$ pm2 delete 0                      # 删除指定应用 id 0
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">其他</h2><a id="user-content-其他" class="anchor" aria-label="Permalink: 其他" href="#其他"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<pre><code>$ pm2 scale api 10                  # 把名字叫api的应用扩展到10个实例
$ pm2 reset [app-name]              # 重置重启数量
$ pm2 startup                       # 创建开机自启动命令
$ pm2 save                          # 保存当前应用列表
$ pm2 resurrect                     # 重新加载保存的应用列表
$ pm2 update                        # Save processes, kill PM2 and restore processes
$ pm2 generate                      # Generate a sample json configuration file
$ pm2 deploy app.json prod setup    # Setup "prod" remote server
$ pm2 deploy app.json prod          # Update "prod" remote server
$ pm2 deploy app.json prod revert 2 # Revert "prod" remote server by 2
$ pm2 module:generate [name]        # Generate sample module with name [name]
$ pm2 install pm2-logrotate         # Install module (here a log rotation system)
$ pm2 uninstall pm2-logrotate       # Uninstall module
$ pm2 publish                       # Increment version, git push and npm publish
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">pm2.json</h2><a id="user-content-pm2json" class="anchor" aria-label="Permalink: pm2.json" href="#pm2json"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="highlight highlight-source-json"><pre>{
  <span class="pl-ent">"apps"</span>: [
    {
      <span class="pl-ent">"name"</span>: <span class="pl-s"><span class="pl-pds">"</span>名称<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"script"</span>: <span class="pl-s"><span class="pl-pds">"</span>脚本名.py<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"instances"</span>: <span class="pl-c1">1</span>,
      <span class="pl-ent">"interpreter"</span>: <span class="pl-s"><span class="pl-pds">"</span>./.venv/bin/python<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"autorestart"</span>: <span class="pl-c1">true</span>,
      <span class="pl-ent">"watch"</span>: [<span class="pl-s"><span class="pl-pds">"</span>main.py<span class="pl-pds">"</span></span>],  <span class="pl-ii"># 监听文件变更</span>
      <span class="pl-ent">"cron_restart"</span>: <span class="pl-s"><span class="pl-pds">"</span>0 0 * * *<span class="pl-pds">"</span></span>, <span class="pl-ii"># 每天0点 定时重启</span>
      <span class="pl-ent">"merge_logs"</span>: <span class="pl-c1">false</span>,   <span class="pl-ii"># 是否合并文件, false时 按pm2 id拆分日志文件, 如error_1.log</span>
      <span class="pl-ent">"log_date_format"</span>: <span class="pl-s"><span class="pl-pds">"</span>YYYY-MM-DD HH:mm Z<span class="pl-pds">"</span></span>, <span class="pl-ii"># 日志日期格式</span>
      <span class="pl-ent">"error_file"</span>: <span class="pl-s"><span class="pl-pds">"</span>logs/error.log<span class="pl-pds">"</span></span>, <span class="pl-ii"># 错误日志文件</span>
      <span class="pl-ent">"out_file"</span>: <span class="pl-s"><span class="pl-pds">"</span>logs/output.log<span class="pl-pds">"</span></span> <span class="pl-ii"># 日志文件  当error_file和out_file配置一样时, 可输出到同一个文件</span>
    }
  ]
}</pre></div>
<div class="markdown-heading"><h2 class="heading-element">pm2-logrotate 日志切割</h2><a id="user-content-pm2-logrotate-日志切割" class="anchor" aria-label="Permalink: pm2-logrotate 日志切割" href="#pm2-logrotate-日志切割"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="highlight highlight-source-shell"><pre>pm2 install pm2-logrotate</pre></div>
<div class="highlight highlight-source-shell"><pre>pm2 conf <span class="pl-c"><span class="pl-c">#</span> 查询配置</span></pre></div>
<p>配置参数：</p>
<div class="highlight highlight-source-shell"><pre>pm2 <span class="pl-c1">set</span> pm2-logrotate:max_size 10M  <span class="pl-c"><span class="pl-c">#</span> 单个文件最大10M</span>
pm2 <span class="pl-c1">set</span> pm2-logrotate:retain 30     <span class="pl-c"><span class="pl-c">#</span> 保留30个历史文件</span>
pm2 <span class="pl-c1">set</span> pm2-logrotate:compress <span class="pl-c1">true</span> <span class="pl-c"><span class="pl-c">#</span> 启用压缩</span>
pm2 <span class="pl-c1">set</span> pm2-logrotate:workerInterval 30 <span class="pl-c"><span class="pl-c">#</span> 每30秒检查日志文件大小</span>
pm2 <span class="pl-c1">set</span> pm2-logrotate:rotateInterval <span class="pl-s"><span class="pl-pds">'</span>0 0 * * *<span class="pl-pds">'</span></span> <span class="pl-c"><span class="pl-c">#</span> 每天0点执行</span></pre></div>
<p>手动触发日志切割</p>
<div class="highlight highlight-source-shell"><pre>pm2 reloadLogs</pre></div>
<div class="markdown-heading"><h2 class="heading-element">相关链接</h2><a id="user-content-相关链接" class="anchor" aria-label="Permalink: 相关链接" href="#相关链接"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ol>
<li><a href="https://github.com/keymetrics/pm2-logrotate">pm2-logrotate</a></li>
</ol>
