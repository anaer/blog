<div class="markdown-heading"><h2 class="heading-element">DNS Over HTTPS</h2><a id="user-content-dns-over-https" class="anchor" aria-label="Permalink: DNS Over HTTPS" href="#dns-over-https"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>DNS over HTTPS（缩写：DoH）是一个进行安全化的域名解析方案。其意义在于以加密的 HTTPS 协议进行 DNS 解析请求，避免原始 DNS 协议中用户的 DNS 解析请求被窃听或者修改的问题（例如中间人攻击）来达到保护用户隐私的目的</p>
<table>
<thead>
<tr>
<th>服务提供商</th>
<th>DoH 地址</th>
<th>DoT 地址</th>
<th>IPS</th>
</tr>
</thead>
<tbody>
<tr>
<td>AdGuard</td>
<td><a href="https://dns.adguard-dns.com/dns-query" rel="nofollow">https://dns.adguard-dns.com/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>AdGuard-无过滤</td>
<td><a href="https://unfiltered.adguard-dns.com/dns-query" rel="nofollow">https://unfiltered.adguard-dns.com/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>AdGuard-家庭</td>
<td><a href="https://family.adguard-dns.com/dns-query" rel="nofollow">https://family.adguard-dns.com/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Blahdns</td>
<td><a href="https://doh-jp.blahdns.com/dns-query" rel="nofollow">https://doh-jp.blahdns.com/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>CleanBrowsing</td>
<td><a href="https://doh.cleanbrowsing.org/doh/family-filter/" rel="nofollow">https://doh.cleanbrowsing.org/doh/family-filter/</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Cloudflare</td>
<td><a href="https://cloudflare-dns.com/dns-query" rel="nofollow">https://cloudflare-dns.com/dns-query</a></td>
<td>cloudflare-dns.com</td>
<td>1.1.1.1</td>
</tr>
<tr>
<td>DNS.SB</td>
<td><a href="https://doh.dns.sb/dns-query" rel="nofollow">https://doh.dns.sb/dns-query</a></td>
<td>dot.sb</td>
<td></td>
</tr>
<tr>
<td>DNS.SB</td>
<td><a href="https://doh.sb/dns-query" rel="nofollow">https://doh.sb/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Google</td>
<td><a href="https://dns.google.com/dns-query" rel="nofollow">https://dns.google.com/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Google</td>
<td><a href="https://dns.google/dns-query" rel="nofollow">https://dns.google/dns-query</a></td>
<td>dns.google</td>
<td></td>
</tr>
<tr>
<td>OpenDNS</td>
<td><a href="https://doh.opendns.com/dns-query" rel="nofollow">https://doh.opendns.com/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Quad9</td>
<td><a href="https://dns.quad9.net/dns-query" rel="nofollow">https://dns.quad9.net/dns-query</a></td>
<td>dns.quad9.net</td>
<td></td>
</tr>
<tr>
<td>rixCloud</td>
<td><a href="https://doh.rixcloud.dev/dns-query" rel="nofollow">https://doh.rixcloud.dev/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>红鱼 DNS</td>
<td><a href="https://rubyfish.cn/dns-query" rel="nofollow">https://rubyfish.cn/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>阿里 DNS</td>
<td><a href="https://dns.alidns.com/dns-query" rel="nofollow">https://dns.alidns.com/dns-query</a></td>
<td>dns.alidns.com</td>
<td></td>
</tr>
<tr>
<td>DNSWatch</td>
<td><a href="https://resolver2.dns.watch/dns-query" rel="nofollow">https://resolver2.dns.watch/dns-query</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>腾讯</td>
<td><a href="https://doh.pub/dns-query" rel="nofollow">https://doh.pub/dns-query</a></td>
<td>dot.pub</td>
<td>1.12.12.12、120.53.53.53</td>
</tr>
<tr>
<td>TWNIC Quad 101</td>
<td><a href="https://dns.twnic.tw/dns-query" rel="nofollow">https://dns.twnic.tw/dns-query</a></td>
<td>dns.twnic.tw</td>
<td></td>
</tr>
</tbody>
</table>
<div class="markdown-heading"><h2 class="heading-element">公共 DNS</h2><a id="user-content-公共-dns" class="anchor" aria-label="Permalink: 公共 DNS" href="#公共-dns"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<table>
<thead>
<tr>
<th>名称</th>
<th>DNS</th>
</tr>
</thead>
<tbody>
<tr>
<td>百度公共 DNS</td>
<td>180.76.76.76</td>
</tr>
<tr>
<td>114 DNS</td>
<td>114.114.114.114</td>
</tr>
<tr>
<td>阿里云公共 DNS</td>
<td>223.5.5.5 / 223.6.6.6</td>
</tr>
<tr>
<td>谷歌公共 DNS</td>
<td>8.8.8.8 / 8.8.4.4</td>
</tr>
</tbody>
</table>
<div class="markdown-heading"><h2 class="heading-element">请求说明</h2><a id="user-content-请求说明" class="anchor" aria-label="Permalink: 请求说明" href="#请求说明"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="highlight highlight-source-shell"><pre>https://dns.adguard.com/dns-query<span class="pl-k">?</span>dns=<span class="pl-k">&lt;</span>base64url encoded data<span class="pl-k">&gt;</span>
https://dns.adguard.com/resolve<span class="pl-k">?</span>name=<span class="pl-k">&lt;</span>domain<span class="pl-k">&gt;&amp;</span>type=<span class="pl-k">&lt;</span>DNS Q/A type<span class="pl-k">&gt;</span></pre></div>
<div class="markdown-heading"><h3 class="heading-element">curl 请求方式</h3><a id="user-content-curl-请求方式" class="anchor" aria-label="Permalink: curl 请求方式" href="#curl-请求方式"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="highlight highlight-source-shell"><pre>$ curl <span class="pl-s"><span class="pl-pds">'</span>https://dns.adguard.com/resolve?name=www.baidu.com&amp;type=A<span class="pl-pds">'</span></span>
{
  <span class="pl-s"><span class="pl-pds">"</span>Question<span class="pl-pds">"</span></span>: [
    {
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>www.baidu.com.<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: 1
    }
  ],
  <span class="pl-s"><span class="pl-pds">"</span>Answer<span class="pl-pds">"</span></span>: [
    {
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>www.baidu.com.<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>www.a.shifen.com.<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>TTL<span class="pl-pds">"</span></span>: 12,
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: 5,
      <span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>: 1
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>www.a.shifen.com.<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>14.119.104.189<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>TTL<span class="pl-pds">"</span></span>: 12,
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: 1,
      <span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>: 1
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>www.a.shifen.com.<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>14.119.104.254<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>TTL<span class="pl-pds">"</span></span>: 12,
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: 1,
      <span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>: 1
    }
  ],
  <span class="pl-s"><span class="pl-pds">"</span>Extra<span class="pl-pds">"</span></span>: null,
  <span class="pl-s"><span class="pl-pds">"</span>TC<span class="pl-pds">"</span></span>: false,
  <span class="pl-s"><span class="pl-pds">"</span>RD<span class="pl-pds">"</span></span>: true,
  <span class="pl-s"><span class="pl-pds">"</span>RA<span class="pl-pds">"</span></span>: true,
  <span class="pl-s"><span class="pl-pds">"</span>AD<span class="pl-pds">"</span></span>: false,
  <span class="pl-s"><span class="pl-pds">"</span>CD<span class="pl-pds">"</span></span>: false,
  <span class="pl-s"><span class="pl-pds">"</span>Status<span class="pl-pds">"</span></span>: 0
}</pre></div>
<div class="markdown-heading"><h2 class="heading-element">python 调用示例</h2><a id="user-content-python-调用示例" class="anchor" aria-label="Permalink: python 调用示例" href="#python-调用示例"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> <span class="pl-s1">dns</span>.<span class="pl-s1">message</span>
<span class="pl-k">import</span> <span class="pl-s1">requests</span>
<span class="pl-k">import</span> <span class="pl-s1">base64</span>
<span class="pl-k">import</span> <span class="pl-s1">json</span>

<span class="pl-s1">doh_url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://dns.alidns.com/dns-query"</span>
<span class="pl-s1">domain</span> <span class="pl-c1">=</span> <span class="pl-s">"alibaba.com"</span>
<span class="pl-s1">rr</span> <span class="pl-c1">=</span> <span class="pl-s">"A"</span>
<span class="pl-s1">result</span> <span class="pl-c1">=</span> []

<span class="pl-s1">message</span> <span class="pl-c1">=</span> <span class="pl-s1">dns</span>.<span class="pl-c1">message</span>.<span class="pl-c1">make_query</span>(<span class="pl-s1">domain</span>, <span class="pl-s1">rr</span>)
<span class="pl-s1">dns_req</span> <span class="pl-c1">=</span> <span class="pl-s1">base64</span>.<span class="pl-c1">b64encode</span>(<span class="pl-s1">message</span>.<span class="pl-c1">to_wire</span>()).<span class="pl-c1">decode</span>(<span class="pl-s">"UTF8"</span>).<span class="pl-c1">rstrip</span>(<span class="pl-s">"="</span>)
<span class="pl-s1">r</span> <span class="pl-c1">=</span> <span class="pl-s1">requests</span>.<span class="pl-c1">get</span>(<span class="pl-s1">doh_url</span> <span class="pl-c1">+</span> <span class="pl-s">"?dns="</span> <span class="pl-c1">+</span> <span class="pl-s1">dns_req</span>,
                 <span class="pl-s1">headers</span><span class="pl-c1">=</span>{<span class="pl-s">"Content-type"</span>: <span class="pl-s">"application/dns-message"</span>})
<span class="pl-k">for</span> <span class="pl-s1">answer</span> <span class="pl-c1">in</span> <span class="pl-s1">dns</span>.<span class="pl-c1">message</span>.<span class="pl-c1">from_wire</span>(<span class="pl-s1">r</span>.<span class="pl-c1">content</span>).<span class="pl-c1">answer</span>:
    <span class="pl-s1">dns</span> <span class="pl-c1">=</span> <span class="pl-s1">answer</span>.<span class="pl-c1">to_text</span>().<span class="pl-c1">split</span>()
    <span class="pl-s1">result</span>.<span class="pl-c1">append</span>({<span class="pl-s">"Query"</span>: <span class="pl-s1">dns</span>[<span class="pl-c1">0</span>], <span class="pl-s">"TTL"</span>: <span class="pl-s1">dns</span>[<span class="pl-c1">1</span>], <span class="pl-s">"RR"</span>: <span class="pl-s1">dns</span>[<span class="pl-c1">3</span>], <span class="pl-s">"Answer"</span>: <span class="pl-s1">dns</span>[<span class="pl-c1">4</span>]})
    <span class="pl-en">print</span>(<span class="pl-s1">json</span>.<span class="pl-c1">dumps</span>(<span class="pl-s1">result</span>))</pre></div>
<div class="highlight highlight-source-shell"><pre>$ python test_doh.py
[{<span class="pl-s"><span class="pl-pds">"</span>Answer<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>106.11.223.101<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Query<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>alibaba.com.<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>RR<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>TTL<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>133<span class="pl-pds">"</span></span>}]</pre></div>
<div class="markdown-heading"><h2 class="heading-element">DNS 污染</h2><a id="user-content-dns-污染" class="anchor" aria-label="Permalink: DNS 污染" href="#dns-污染"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>DNS 污染大致与以下内容为同义词：</p>
<p>DNS 缓存服务器污染：运营商的 DNS 服务器被污染，使用默认 DNS，网络就会被干扰。</p>
<p>DNS 抢答：DNS 请求没有防篡改功能，所以中间人能抢先发送错误的 DNS，网络就会被干扰。</p>
<p>DNS 劫持：使用自定义 DNS，同样是缺乏防篡改功能，所以中间人能劫持 DNS 请求，网络就会被干扰。</p>
<p>应对方法分别是：</p>
<p>DNS 缓存服务器污染：直接换 114.114.114.114 与 8.8.8.8 这样的非运营商的 DNS，只要没有抢答和劫持，就有效。</p>
<p>DNS 抢答：修改系统内核，使系统忽略错误的 DNS，因为早期 GFW 抢答给出的错误 IP 数量不多，然后真正的 DNS 返回的 IP，就能被正常使用。</p>
<p>DNS 劫持：使用 DNS over HTTPS（HTTP over TLS）、DNS over TLS 等方式，通过加密的协议来保护 DNS 请求。只要 GFW 没有将提供服务的域名，进行 SNI 封禁，就有效。</p>
<div class="markdown-heading"><h2 class="heading-element">相关链接</h2><a id="user-content-相关链接" class="anchor" aria-label="Permalink: 相关链接" href="#相关链接"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p><a href="https://zh.wikipedia.org/wiki/DNS_over_HTTPS" rel="nofollow">DNS_over_HTTPS - 维基百科</a></p>
<p><a href="https://www.alibabacloud.com/help/zh/alibaba-cloud-public-dns/latest/dns-over-https" rel="nofollow">DNS over HTTPs(DoH)</a></p>
<p><a href="https://adguard-dns.io/zh_cn/welcome.html" rel="nofollow">AdGuard</a></p>
