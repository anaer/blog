<div class="markdown-heading"><h2 class="heading-element">自动化</h2><a id="user-content-自动化" class="anchor" aria-label="Permalink: 自动化" href="#自动化"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="markdown-heading"><h3 class="heading-element">Webhook</h3><a id="user-content-webhook" class="anchor" aria-label="Permalink: Webhook" href="#webhook"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>POST 请求, 会将feed条目信息作为Json参数进行请求, 所以如果要较好处理的话, 可能需要自定义一个webhook接口进行处理</p>
<pre lang="jsonp"><code>{'entry': {'id': 'xxx', 'publishedAt': '2025-02-06T06:31:29.669Z', 'insertedAt': '2025-02-06T06:42:55.467Z', 'feedId': '85248513348230144', 'title': "xxx", 'description': 'xxx', 'content': 'xxx', 'author': None, 'url': 'xxx', 'guid': 'xxx', 'media': [{'url': 'xxx', 'type': 'photo', 'width': 492, 'height': 656}]}, 'feed': {'title': 'xxx', 'description': 'xxx', 'siteUrl': 'https://xxx', 'image': 'https://xxx', 'checkedAt': '2025-02-06T06:42:55.466Z', 'ttl': 30, 'url': 'https://xxxx', 'lastModifiedHeader': 'Thu, 06 Feb 2025 06:42:54 GMT', 'etagHeader': '"ee35-WBbJJibnAIpo+80xxx/iPxbcxxx"', 'errorMessage': None, 'errorAt': None}, 'view': 5}
</code></pre>
<p>如果直接配置bark接口地址, 因为参数命名凑巧一致的情况下, 能推送成功一条空标题的消息, 内容为条目url链接
后期要看Follow是否会对一些推送接口进行适配.</p>
<div class="markdown-heading"><h2 class="heading-element">Follow Feed分享页自动订阅</h2><a id="user-content-follow-feed分享页自动订阅" class="anchor" aria-label="Permalink: Follow Feed分享页自动订阅" href="#follow-feed分享页自动订阅"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>因为目前主要在Web端使用, 在分享页订阅时 老是要跳转下载客户端. 所以实现该脚本:</p>
<ol>
<li>从链接获取feed id</li>
<li>查询feed信息接口 判断是否订阅</li>
<li>调用feed订阅接口 进行订阅, 设定临时分类</li>
</ol>
<p>有需要再进行优化</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c">// ==UserScript==</span>
<span class="pl-c">// <span class="pl-k">@name</span>         Follow分享页 自动订阅</span>
<span class="pl-c">// <span class="pl-k">@namespace</span>    http://tampermonkey.net/</span>
<span class="pl-c">// <span class="pl-k">@version</span>      1.0</span>
<span class="pl-c">// <span class="pl-k">@description</span>  从当前页面 URL 中提取最后一段数字 ID</span>
<span class="pl-c">// <span class="pl-k">@author</span>       anaer</span>
<span class="pl-c">// <span class="pl-k">@match</span>        https://app.follow.is/share/feeds/*</span>
<span class="pl-c">// <span class="pl-k">@grant</span>        GM_addStyle</span>
<span class="pl-c">// <span class="pl-k">@grant</span>        GM_xmlhttpRequest</span>
<span class="pl-c">// <span class="pl-k">@grant</span>        unsafeWindow</span>
<span class="pl-c">// ==/UserScript==</span>

<span class="pl-kos">(</span><span class="pl-k">function</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-s">'use strict'</span><span class="pl-kos">;</span>

  <span class="pl-k">const</span> <span class="pl-en">xget</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">url</span><span class="pl-kos">,</span> <span class="pl-s1">type</span> <span class="pl-c1">=</span> <span class="pl-s">'json'</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-k">new</span> <span class="pl-v">Promise</span><span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">success</span><span class="pl-kos">,</span> <span class="pl-s1">fail</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
	<span class="pl-v">GM_xmlhttpRequest</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
		<span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
		<span class="pl-c1">timeout</span>: <span class="pl-c1">3000</span><span class="pl-kos">,</span>
    <span class="pl-c1">credentials</span>: <span class="pl-s">'include'</span><span class="pl-kos">,</span> <span class="pl-c">// 携带浏览器 Cookies</span>
		<span class="pl-c1">url</span>: <span class="pl-s1">url</span><span class="pl-kos">,</span>
		<span class="pl-c1">responseType</span>: <span class="pl-s1">type</span><span class="pl-kos">,</span>
		<span class="pl-c1">onload</span>: <span class="pl-s1">success</span><span class="pl-kos">,</span>
		<span class="pl-c1">onerror</span>: <span class="pl-s1">fail</span><span class="pl-kos">,</span>
		<span class="pl-c1">ontimeout</span>: <span class="pl-s1">fail</span>
	<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

  <span class="pl-k">const</span> <span class="pl-en">xpost</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">url</span><span class="pl-kos">,</span> <span class="pl-s1">data</span><span class="pl-c1">=</span><span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-k">new</span> <span class="pl-v">Promise</span><span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">success</span><span class="pl-kos">,</span> <span class="pl-s1">fail</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
	<span class="pl-v">GM_xmlhttpRequest</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
		<span class="pl-c1">method</span>: <span class="pl-s">'POST'</span><span class="pl-kos">,</span>
		<span class="pl-c1">timeout</span>: <span class="pl-c1">3000</span><span class="pl-kos">,</span>
    <span class="pl-c1">credentials</span>: <span class="pl-s">'include'</span><span class="pl-kos">,</span> <span class="pl-c">// 携带浏览器 Cookies</span>
    <span class="pl-c1">headers</span>: <span class="pl-kos">{</span>
        <span class="pl-s">'Content-Type'</span>: <span class="pl-s">'application/json'</span><span class="pl-kos">,</span> <span class="pl-c">// 设置请求头</span>
    <span class="pl-kos">}</span><span class="pl-kos">,</span>
		<span class="pl-c1">url</span>: <span class="pl-s1">url</span><span class="pl-kos">,</span>
    <span class="pl-c1">data</span>: <span class="pl-s1">data</span><span class="pl-kos">,</span>
		<span class="pl-c1">responseType</span>: <span class="pl-s">'json'</span><span class="pl-kos">,</span>
		<span class="pl-c1">onload</span>: <span class="pl-s1">success</span><span class="pl-kos">,</span>
		<span class="pl-c1">onerror</span>: <span class="pl-s1">fail</span><span class="pl-kos">,</span>
		<span class="pl-c1">ontimeout</span>: <span class="pl-s1">fail</span>
	<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-c">// 获取当前页面的 URL</span>
    <span class="pl-k">const</span> <span class="pl-s1">currentUrl</span> <span class="pl-c1">=</span> <span class="pl-smi">window</span><span class="pl-kos">.</span><span class="pl-c1">location</span><span class="pl-kos">.</span><span class="pl-c1">href</span><span class="pl-kos">;</span>

    <span class="pl-c">// 使用正则表达式提取最后一段数字 ID</span>
    <span class="pl-k">const</span> <span class="pl-s1">match</span> <span class="pl-c1">=</span> <span class="pl-s1">currentUrl</span><span class="pl-kos">.</span><span class="pl-en">match</span><span class="pl-kos">(</span><span class="pl-pds"><span class="pl-c1">/</span><span class="pl-cce">\/</span><span class="pl-kos">(</span><span class="pl-cce">\d</span><span class="pl-c1">+</span><span class="pl-kos">)</span><span class="pl-cce">\/</span><span class="pl-c1">?</span><span class="pl-cce">$</span><span class="pl-c1">/</span></span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">var</span> <span class="pl-s1">id</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">match</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">match</span><span class="pl-kos">[</span><span class="pl-c1">1</span><span class="pl-kos">]</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-s1">id</span> <span class="pl-c1">=</span> <span class="pl-s1">match</span><span class="pl-kos">[</span><span class="pl-c1">1</span><span class="pl-kos">]</span><span class="pl-kos">;</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'提取的数字 ID:'</span><span class="pl-kos">,</span> <span class="pl-s1">id</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'未找到数字 ID'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">let</span> <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">'https://api.follow.is/feeds?id='</span><span class="pl-c1">+</span><span class="pl-s1">id</span>
			<span class="pl-en">xget</span><span class="pl-kos">(</span><span class="pl-s1">url</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">then</span><span class="pl-kos">(</span><span class="pl-s1">r</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
				<span class="pl-k">const</span> <span class="pl-s1">ra</span> <span class="pl-c1">=</span> <span class="pl-s1">r</span><span class="pl-kos">.</span><span class="pl-c1">response</span><span class="pl-kos">;</span>
				<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">url</span><span class="pl-kos">,</span> <span class="pl-s1">ra</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">ra</span><span class="pl-kos">.</span><span class="pl-c1">data</span><span class="pl-kos">.</span><span class="pl-c1">subscription</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
          <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'已订阅'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span><span class="pl-k">else</span><span class="pl-kos">{</span>
          <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'未订阅'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
          <span class="pl-k">let</span> <span class="pl-s1">feed</span> <span class="pl-c1">=</span> <span class="pl-s1">unsafeWindow</span><span class="pl-kos">.</span><span class="pl-c1">__HYDRATE__</span><span class="pl-kos">[</span><span class="pl-s">'feeds.$get,query:id='</span><span class="pl-c1">+</span><span class="pl-s1">id</span><span class="pl-kos">]</span><span class="pl-kos">[</span><span class="pl-s">'feed'</span><span class="pl-kos">]</span>

          <span class="pl-k">var</span> <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-c1">JSON</span><span class="pl-kos">.</span><span class="pl-en">stringify</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
              <span class="pl-c1">feedId</span>: <span class="pl-s1">feed</span><span class="pl-kos">.</span><span class="pl-c1">id</span><span class="pl-kos">,</span>
              <span class="pl-c1">url</span>: <span class="pl-s1">feed</span><span class="pl-kos">.</span><span class="pl-c1">url</span><span class="pl-kos">,</span>
              <span class="pl-c1">view</span>: <span class="pl-c1">0</span><span class="pl-kos">,</span>
              <span class="pl-c1">category</span>: <span class="pl-s">"待定"</span>
            <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
          <span class="pl-en">xpost</span><span class="pl-kos">(</span><span class="pl-s">'https://api.follow.is/subscriptions'</span><span class="pl-kos">,</span> <span class="pl-s1">data</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">then</span><span class="pl-kos">(</span><span class="pl-s1">r</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
            <span class="pl-k">const</span> <span class="pl-s1">ra</span> <span class="pl-c1">=</span> <span class="pl-s1">r</span><span class="pl-kos">.</span><span class="pl-c1">response</span><span class="pl-kos">;</span>
            <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'订阅成功'</span><span class="pl-kos">,</span> <span class="pl-s1">data</span><span class="pl-kos">,</span> <span class="pl-s1">ra</span><span class="pl-kos">)</span>
          <span class="pl-kos">}</span><span class="pl-kos">)</span>
          <span class="pl-kos">.</span><span class="pl-en">catch</span> <span class="pl-kos">(</span><span class="pl-s1">e</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
            <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'订阅失败'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
          <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>

			<span class="pl-kos">}</span><span class="pl-kos">)</span>
			<span class="pl-kos">.</span><span class="pl-en">catch</span> <span class="pl-kos">(</span><span class="pl-s1">e</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
				<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">url</span><span class="pl-kos">,</span> <span class="pl-s">'获取feed信息异常'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
			<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
