<div class="markdown-heading"><h2 class="heading-element">安装配置</h2><a id="user-content-安装配置" class="anchor" aria-label="Permalink: 安装配置" href="#安装配置"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="highlight highlight-source-shell"><pre>mkdir -p /data/minio/data

docker run \
   -p 9900:9000 \
   -p 9901:9001 \
   --name minio \
   -v /data/minio/data:/data \
   -e <span class="pl-s"><span class="pl-pds">"</span>MINIO_ROOT_USER=minio<span class="pl-pds">"</span></span> \
   -e <span class="pl-s"><span class="pl-pds">"</span>MINIO_ROOT_PASSWORD=minio123<span class="pl-pds">"</span></span> \
   quay.io/minio/minio server /data --console-address <span class="pl-s"><span class="pl-pds">"</span>:9001<span class="pl-pds">"</span></span>
   
 9901: 控制台
 9900: 服务ip


mc <span class="pl-c1">alias</span> <span class="pl-c1">set</span> oss https://oss-cn-shanghai.aliyuncs.com/ ACCESS_KEY ACCESS_SECRET

mc <span class="pl-c1">alias</span> <span class="pl-c1">set</span> myminio http://127.0.0.1:9900 ACCESS_KEY ACCESS_SECRET

mc mirror oss/my-oss-bucket/ myminio/my-minio-bucket/

mc --debug mirror --watch myminio/my-minio-bucket/ oss/my-oss-bucket/ 

PS: 貌似--watch的源服务只支持本地文件或者minio服务, 不支持oss, 所以自动sync, 可能需要结合crontab

mc mirror \
  --overwrite <span class="pl-cce">\ </span>           <span class="pl-c"><span class="pl-c">#</span> 覆盖目标已有文件</span>
  --remove <span class="pl-cce">\ </span>              <span class="pl-c"><span class="pl-c">#</span> 删除目标端多余文件（保持完全同步）</span>
  --exclude <span class="pl-s"><span class="pl-pds">"</span>*.tmp<span class="pl-pds">"</span></span> <span class="pl-cce">\ </span>     <span class="pl-c"><span class="pl-c">#</span> 排除特定文件（如临时文件）</span>
  --watch <span class="pl-cce">\ </span>               <span class="pl-c"><span class="pl-c">#</span> 监听文件变化持续同步</span>
  oss/my-oss-bucket/ myminio/my-minio-bucket/


Public库: http://127.0.0.1:9900/my-minio-bucket/path/xxx/name.jpeg
Private库: 需要获取签名链接
http://127.0.0.1:9900/my-minio-bucket/path/xxx/name.jpeg<span class="pl-k">?</span>X-Amz-Algorithm=AWS4-HMAC-SHA256<span class="pl-k">&amp;</span>X-Amz-Credential=z8ETVdfI8spMeEhKXngv%2F20250427%2Fus-east-1%2Fs3%2Faws4_request<span class="pl-k">&amp;</span>X-Amz-Date=20250427T081624Z<span class="pl-k">&amp;</span>X-Amz-Expires=604800<span class="pl-k">&amp;</span>X-Amz-SignedHeaders=host<span class="pl-k">&amp;</span>X-Amz-Signature=69203ea0b2278062e2fdc67cc6fd82b4c172676a04f2b066c61f8a5eb0fb6cf8
</pre></div>
<div class="markdown-heading"><h2 class="heading-element">minio防盗链</h2><a id="user-content-minio防盗链" class="anchor" aria-label="Permalink: minio防盗链" href="#minio防盗链"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ol>
<li>存储桶配置私有Private模式</li>
<li>添加nginx反代, 添加白名单配置</li>
</ol>
<div class="markdown-heading"><h2 class="heading-element">minio同步脚本</h2><a id="user-content-minio同步脚本" class="anchor" aria-label="Permalink: minio同步脚本" href="#minio同步脚本"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>minio_sync.sh</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-c"><span class="pl-c">#!</span>/bin/bash</span>

<span class="pl-c"><span class="pl-c">#</span> 定义锁文件路径</span>
LOCKFILE=/tmp/minio_sync.lock

<span class="pl-c"><span class="pl-c">#</span> 检查锁文件是否存在</span>
<span class="pl-k">if</span> [ <span class="pl-k">-e</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$LOCKFILE</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
  <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>minio sync is already running. Exiting.<span class="pl-pds">"</span></span>
  <span class="pl-c1">exit</span> 1
<span class="pl-k">fi</span>

<span class="pl-c"><span class="pl-c">#</span> 创建锁文件</span>
touch <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$LOCKFILE</span><span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> 捕获脚本退出信号，删除锁文件</span>
<span class="pl-c1">trap</span> <span class="pl-s"><span class="pl-pds">'</span>rm -f "$LOCKFILE"; exit<span class="pl-pds">'</span></span> INT TERM EXIT

<span class="pl-c"><span class="pl-c">#</span> 你的任务逻辑</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>Running task at <span class="pl-s"><span class="pl-pds">$(</span>date<span class="pl-pds">)</span></span><span class="pl-pds">"</span></span> <span class="pl-k">&gt;&gt;</span> /data/minio/minio_sync.log
<span class="pl-c"><span class="pl-c">#</span> 其他任务命令...</span>
/usr/local/bin/mc mirror oss/my-oss-bucket/ myminio/my-minio-bucket/

<span class="pl-c"><span class="pl-c">#</span> 任务完成后，锁文件会在 trap 中自动删除</span>
</pre></div>
<p><code>crontab -e</code></p>
<pre><code>* * * * * sh /data/minio/minio_sync.sh &gt;&gt; /data/minio/minio_sync.log 2&gt;&amp;1
</code></pre>
<pre lang="log"><code>Running task at Mon Apr 28 10:13:02 CST 2025
┌───────┬─────────────┬──────────┬───────┐
│ Total │ Transferred │ Duration │ Speed │
│ 0 B   │ 0 B         │ 00m00s   │ 0 B/s │
└───────┴─────────────┴──────────┴───────┘
</code></pre>
<div class="markdown-heading"><h2 class="heading-element">mc命令</h2><a id="user-content-mc命令" class="anchor" aria-label="Permalink: mc命令" href="#mc命令"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<table>
<thead>
<tr>
<th><strong>分类</strong></th>
<th><strong>命令</strong></th>
<th><strong>功能说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>配置管理</strong></td>
<td><code>mc alias</code></td>
<td>添加/管理云存储服务别名</td>
<td><code>mc alias set myminio http://localhost:9000 ACCESS_KEY SECRET_KEY</code></td>
</tr>
<tr>
<td><strong>配置管理</strong></td>
<td><code>mc config host list</code></td>
<td>列出所有已配置的别名</td>
<td><code>mc config host list</code></td>
</tr>
<tr>
<td><strong>存储桶操作</strong></td>
<td><code>mc mb</code></td>
<td>创建存储桶</td>
<td><code>mc mb myminio/mybucket</code></td>
</tr>
<tr>
<td><strong>存储桶操作</strong></td>
<td><code>mc ls</code></td>
<td>列出存储桶或对象（支持 <code>--recursive</code> 递归）</td>
<td><code>mc ls myminio/mybucket/docs/</code></td>
</tr>
<tr>
<td><strong>存储桶操作</strong></td>
<td><code>mc rb</code></td>
<td>删除空存储桶</td>
<td><code>mc rb myminio/mybucket</code></td>
</tr>
<tr>
<td><strong>存储桶操作</strong></td>
<td><code>mc du</code></td>
<td>显示存储桶/目录占用空间</td>
<td><code>mc du myminio/mybucket --recursive</code></td>
</tr>
<tr>
<td><strong>存储桶操作</strong></td>
<td><code>mc mirror</code></td>
<td>同步本地目录到存储桶</td>
<td><code>mc mirror ./local_dir myminio/mybucket</code></td>
</tr>
<tr>
<td><strong>对象操作</strong></td>
<td><code>mc cp</code></td>
<td>上传/下载文件或目录</td>
<td>
<code>mc cp file.txt myminio/mybucket/docs/</code><br><code>mc cp myminio/mybucket/file.txt ./</code>
</td>
</tr>
<tr>
<td><strong>对象操作</strong></td>
<td><code>mc mv</code></td>
<td>移动对象</td>
<td><code>mc mv myminio/mybucket/old.txt myminio/mybucket/new.txt</code></td>
</tr>
<tr>
<td><strong>对象操作</strong></td>
<td><code>mc rm</code></td>
<td>删除对象（支持 <code>--recursive</code> 递归）</td>
<td><code>mc rm myminio/mybucket/temp --recursive</code></td>
</tr>
<tr>
<td><strong>对象操作</strong></td>
<td><code>mc stat</code></td>
<td>查看对象详细信息</td>
<td><code>mc stat myminio/mybucket/file.zip</code></td>
</tr>
<tr>
<td><strong>对象操作</strong></td>
<td><code>mc cat</code></td>
<td>直接输出对象内容到控制台</td>
<td><code>mc cat myminio/mybucket/logs/app.log</code></td>
</tr>
<tr>
<td><strong>对象操作</strong></td>
<td><code>mc diff</code></td>
<td>比较两个存储桶/目录内容差异</td>
<td><code>mc diff myminio/mybucket myminio/anotherbucket</code></td>
</tr>
<tr>
<td><strong>权限管理</strong></td>
<td><code>mc policy</code></td>
<td>设置存储桶访问策略（<code>none</code>, <code>download</code>, <code>upload</code>, <code>public</code>）</td>
<td><code>mc policy set public myminio/mybucket</code></td>
</tr>
<tr>
<td><strong>权限管理</strong></td>
<td><code>mc admin policy</code></td>
<td>管理用户权限策略（需管理员权限）</td>
<td><code>mc admin policy create myminio mypolicy policy.json</code></td>
</tr>
<tr>
<td><strong>权限管理</strong></td>
<td><code>mc admin user</code></td>
<td>管理用户（添加/删除/启用/禁用）</td>
<td><code>mc admin user add myminio newuser newpassword</code></td>
</tr>
<tr>
<td><strong>分享与访问</strong></td>
<td><code>mc share download</code></td>
<td>生成文件临时下载链接（默认7天有效期）</td>
<td><code>mc share download myminio/mybucket/file.pdf --expire=72h</code></td>
</tr>
<tr>
<td><strong>分享与访问</strong></td>
<td><code>mc share upload</code></td>
<td>生成文件上传链接</td>
<td><code>mc share upload myminio/mybucket/ --expire=24h</code></td>
</tr>
<tr>
<td><strong>运维与监控</strong></td>
<td><code>mc admin info</code></td>
<td>显示服务器健康状态</td>
<td><code>mc admin info myminio</code></td>
</tr>
<tr>
<td><strong>运维与监控</strong></td>
<td><code>mc admin server info</code></td>
<td>查看单个节点详细信息</td>
<td><code>mc admin server info myminio/</code></td>
</tr>
<tr>
<td><strong>运维与监控</strong></td>
<td><code>mc support diag</code></td>
<td>生成诊断报告</td>
<td><code>mc support diag myminio</code></td>
</tr>
<tr>
<td><strong>运维与监控</strong></td>
<td><code>mc watch</code></td>
<td>实时监控存储桶事件</td>
<td><code>mc watch myminio/mybucket</code></td>
</tr>
<tr>
<td><strong>其他实用</strong></td>
<td><code>mc find</code></td>
<td>根据条件查找文件（名称、大小、时间等）</td>
<td><code>mc find myminio/mybucket --name "*.log" --size "+10MB"</code></td>
</tr>
<tr>
<td><strong>其他实用</strong></td>
<td><code>mc sql</code></td>
<td>使用 SQL 查询对象数据（需配置）</td>
<td><code>mc sql myminio/mybucket "SELECT * FROM S3Object"</code></td>
</tr>
<tr>
<td><strong>其他实用</strong></td>
<td><code>mc encrypt</code></td>
<td>配置存储桶加密</td>
<td><code>mc encrypt set sse-s3 myminio/mybucket</code></td>
</tr>
</tbody>
</table>
<div class="markdown-heading"><h2 class="heading-element">相关文档</h2><a id="user-content-相关文档" class="anchor" aria-label="Permalink: 相关文档" href="#相关文档"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<ol>
<li><a href="https://min.io/docs/minio/linux/developers/minio-drivers.html" rel="nofollow">minio sdk</a></li>
</ol>
